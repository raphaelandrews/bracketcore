{
  "$schema": "https://ui.shadcn.com/schema/registry-item.json",
  "name": "swiss-stage",
  "title": "Swiss Stage",
  "description": "Swiss system bracket with round-by-round matches and standings table.",
  "dependencies": [
    "clsx",
    "tailwind-merge",
    "lucide-react"
  ],
  "registryDependencies": [
    "https://bracketcore.andrews.sh/r/match-card.json"
  ],
  "files": [
    {
      "path": "registry/bracketcore/swiss-stage.tsx",
      "content": "import type { SwissBracket, Match, Team } from \"@/types/bracketcore\";\nimport { MatchCard } from \"@/components/bracketcore/match-card\";\nimport { cn } from \"@/lib/utils\";\n\nfunction ArrowIcon({ className }: { className?: string }) {\n  return (\n    <svg\n      xmlns=\"http://www.w3.org/2000/svg\"\n      viewBox=\"0 0 24 24\"\n      fill=\"none\"\n      stroke=\"currentColor\"\n      strokeWidth={2}\n      strokeLinecap=\"round\"\n      strokeLinejoin=\"round\"\n      className={className}\n    >\n      <path d=\"m6 17 5-5-5-5\" />\n      <path d=\"m13 17 5-5-5-5\" />\n    </svg>\n  );\n}\n\nexport interface SwissStageProps {\n  bracket: SwissBracket;\n  className?: string;\n  onMatchClick?: (match: Match) => void;\n}\n\ntype TeamRecord = { wins: number; losses: number };\n\nfunction getTeamRecord(teamId: string, history: Match[]): TeamRecord {\n  let wins = 0;\n  let losses = 0;\n\n  for (const match of history) {\n    if (match.status !== \"completed\") continue;\n    const teamEntry = match.teams.find((t) => t.team?.id === teamId);\n    if (!teamEntry) continue;\n\n    if (teamEntry.isWinner) wins++;\n    else losses++;\n  }\n  return { wins, losses };\n}\n\nfunction getTeamsWithRecord(bracket: SwissBracket, wins: number, losses: number): Team[] {\n  return bracket.standings.filter((s) => s.wins === wins && s.losses === losses).map((s) => s.team);\n}\n\nfunction getMatchesForPool(\n  roundMatches: Match[],\n  completedMatchesInBracket: Match[],\n  targetWins: number,\n  targetLosses: number,\n): Match[] {\n  if (!roundMatches) return [];\n  return roundMatches.filter((match) => {\n    const team1 = match.teams[0]?.team;\n\n    if (!team1) return false;\n\n    const history = completedMatchesInBracket.filter(\n      (m) => m.id !== match.id && m.round < (match.round ?? 999),\n    );\n    const rec = getTeamRecord(team1.id, history);\n\n    return rec.wins === targetWins && rec.losses === targetLosses;\n  });\n}\n\nfunction TeamListBlock({\n  teams,\n  record,\n  title,\n  type,\n}: {\n  teams: Team[];\n  record: string;\n  title?: string;\n  type: \"good\" | \"bad\";\n}) {\n  const isGood = type === \"good\";\n\n  if (teams.length === 0) return null;\n\n  return (\n    <div\n      className={cn(\n        \"w-48 rounded-md border flex flex-col overflow-hidden shrink-0\",\n        isGood ? \"bg-emerald-500/10 border-emerald-500/20\" : \"bg-red-500/10 border-red-500/20\",\n      )}\n    >\n      <div\n        className={cn(\n          \"px-3 py-1.5 text-xs font-bold flex justify-between items-center border-b\",\n          isGood\n            ? \"text-emerald-500 border-emerald-500/20 bg-emerald-500/10\"\n            : \"text-red-500 border-red-500/20 bg-red-500/10\",\n        )}\n      >\n        <span>{record.replace(\"-\", \":\")}</span>\n        {title && <span className=\"opacity-70 font-normal\">{title}</span>}\n      </div>\n      <div className=\"flex flex-col p-1 gap-1\">\n        {teams.map((team) => (\n          <div\n            key={team.id}\n            className=\"flex items-center gap-2 px-2 py-1 rounded hover:bg-black/5 dark:hover:bg-white/5 transition-colors\"\n          >\n            {team.logo ? (\n              <img src={team.logo} className=\"w-4 h-4 object-contain\" alt={team.name} />\n            ) : (\n              <div className=\"w-4 h-4 bg-foreground/10 rounded-full\" />\n            )}\n            <span className=\"text-xs font-medium truncate\">{team.name}</span>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n\nfunction MatchPoolBlock({\n  matches,\n  record,\n  onMatchClick,\n  nextUp,\n  nextDown,\n  isLast,\n  isFinal,\n}: {\n  matches: Match[];\n  record: string;\n  onMatchClick?: (m: Match) => void;\n  nextUp?: boolean;\n  nextDown?: boolean;\n  isLast?: boolean;\n  isFinal?: boolean;\n}) {\n  if (matches.length === 0) {\n    if (!isLast) return <div className=\"w-48 h-24\" />;\n    return null;\n  }\n\n  return (\n    <div className=\"relative group/pool\">\n      <div className=\"text-xs font-medium text-muted-foreground mb-1.5 pl-1 opacity-70\">\n        {record.replace(\"-\", \":\")}\n      </div>\n\n      <div className=\"flex flex-col gap-3 relative\">\n        {matches.map((match) => (\n          <MatchCard\n            key={match.id}\n            match={match}\n            onMatchClick={onMatchClick}\n            className=\"w-48 text-xs\"\n          />\n        ))}\n\n        {nextUp && (\n          <div\n            className={cn(\n              \"absolute text-emerald-500/50 group-hover/pool:text-emerald-500 transition-colors\",\n              isFinal ? \"right-1/2 -top-8 translate-x-1/2\" : \"-right-10 -top-4\",\n            )}\n          >\n            <div className=\"relative\">\n              <ArrowIcon className={cn(\"w-6 h-6\", isFinal ? \"-rotate-90\" : \"-rotate-30\")} />\n            </div>\n          </div>\n        )}\n        {nextDown && (\n          <div\n            className={cn(\n              \"absolute text-red-500/50 group-hover/pool:text-red-500 transition-colors\",\n              isFinal ? \"right-1/2 -bottom-8 translate-x-1/2\" : \"-right-10 -bottom-4\",\n            )}\n          >\n            <ArrowIcon className={cn(\"w-6 h-6\", isFinal ? \"rotate-90\" : \"rotate-30\")} />\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n\nexport function SwissStage({ bracket, className, onMatchClick }: SwissStageProps) {\n  const allMatches = bracket.rounds.flatMap((r) => r.matches);\n\n  const r1 = bracket.rounds[0]?.matches || [];\n  const r2 = bracket.rounds[1]?.matches || [];\n  const r3 = bracket.rounds[2]?.matches || [];\n  const r4 = bracket.rounds[3]?.matches || [];\n  const r5 = bracket.rounds[4]?.matches || [];\n\n  const pool0_0 = getMatchesForPool(r1, allMatches, 0, 0);\n\n  const pool1_0 = getMatchesForPool(r2, allMatches, 1, 0);\n  const pool0_1 = getMatchesForPool(r2, allMatches, 0, 1);\n\n  const pool2_0 = getMatchesForPool(r3, allMatches, 2, 0);\n  const pool1_1 = getMatchesForPool(r3, allMatches, 1, 1);\n  const pool0_2 = getMatchesForPool(r3, allMatches, 0, 2);\n\n  const teams3_0 = getTeamsWithRecord(bracket, 3, 0);\n  const pool2_1 = getMatchesForPool(r4, allMatches, 2, 1);\n  const pool1_2 = getMatchesForPool(r4, allMatches, 1, 2);\n  const teams0_3 = getTeamsWithRecord(bracket, 0, 3);\n\n  const teams3_1 = getTeamsWithRecord(bracket, 3, 1);\n  const teams3_2 = getTeamsWithRecord(bracket, 3, 2);\n  const pool2_2 = getMatchesForPool(r5, allMatches, 2, 2);\n  const teams2_3 = getTeamsWithRecord(bracket, 2, 3);\n  const teams1_3 = getTeamsWithRecord(bracket, 1, 3);\n\n  return (\n    <div className={cn(\"p-6 overflow-x-auto\", className)}>\n      <div className=\"flex gap-16 min-w-max\">\n        <div className=\"flex flex-col justify-center\">\n          <MatchPoolBlock\n            matches={pool0_0}\n            record=\"0-0\"\n            onMatchClick={onMatchClick}\n            nextUp\n            nextDown\n          />\n        </div>\n\n        <div className=\"flex flex-col justify-center gap-24\">\n          <MatchPoolBlock\n            matches={pool1_0}\n            record=\"1-0\"\n            onMatchClick={onMatchClick}\n            nextUp\n            nextDown\n          />\n          <MatchPoolBlock\n            matches={pool0_1}\n            record=\"0-1\"\n            onMatchClick={onMatchClick}\n            nextUp\n            nextDown\n          />\n        </div>\n\n        <div className=\"flex flex-col justify-center gap-16\">\n          <MatchPoolBlock\n            matches={pool2_0}\n            record=\"2-0\"\n            onMatchClick={onMatchClick}\n            nextUp\n            nextDown\n          />\n          <div className=\"py-2\">\n            <MatchPoolBlock\n              matches={pool1_1}\n              record=\"1-1\"\n              onMatchClick={onMatchClick}\n              nextUp\n              nextDown\n            />\n          </div>\n          <MatchPoolBlock\n            matches={pool0_2}\n            record=\"0-2\"\n            onMatchClick={onMatchClick}\n            nextUp\n            nextDown\n          />\n        </div>\n\n        <div className=\"flex flex-col relative py-2\">\n          <div className=\"mb-auto\">\n            <TeamListBlock teams={teams3_0} record=\"3-0\" type=\"good\" />\n          </div>\n\n          <div className=\"flex flex-col gap-12 my-12 justify-center\">\n            <MatchPoolBlock\n              matches={pool2_1}\n              record=\"2-1\"\n              onMatchClick={onMatchClick}\n              nextUp\n              nextDown\n            />\n            <MatchPoolBlock\n              matches={pool1_2}\n              record=\"1-2\"\n              onMatchClick={onMatchClick}\n              nextUp\n              nextDown\n            />\n          </div>\n\n          <div className=\"mt-auto\">\n            <TeamListBlock teams={teams0_3} record=\"0-3\" type=\"bad\" />\n          </div>\n        </div>\n\n        <div className=\"flex flex-col relative py-2\">\n          <div className=\"mb-auto space-y-4\">\n            <TeamListBlock teams={teams3_1} record=\"3-1\" type=\"good\" />\n            <TeamListBlock teams={teams3_2} record=\"3-2\" type=\"good\" />\n          </div>\n\n          <div className=\"my-12 flex flex-col justify-center\">\n            <MatchPoolBlock\n              matches={pool2_2}\n              record=\"2-2\"\n              onMatchClick={onMatchClick}\n              nextUp\n              nextDown\n              isFinal\n            />\n          </div>\n\n          <div className=\"mt-auto space-y-4\">\n            <TeamListBlock teams={teams2_3} record=\"2-3\" type=\"bad\" />\n            <TeamListBlock teams={teams1_3} record=\"1-3\" type=\"bad\" />\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/bracketcore/swiss-stage.tsx"
    },
    {
      "path": "registry/bracketcore/match-card.tsx",
      "content": "import type { Match, MatchTeam } from \"@/types/bracketcore\";\nimport { cn } from \"@/lib/utils\";\n\nconst WEEKDAYS = [\"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\", \"Thursday\", \"Friday\", \"Saturday\"];\nconst MONTHS = [\"Jan\", \"Feb\", \"Mar\", \"Apr\", \"May\", \"Jun\", \"Jul\", \"Aug\", \"Sep\", \"Oct\", \"Nov\", \"Dec\"];\n\nfunction formatSchedule(value: Date | string): { time: string; day: string } {\n  const date = value instanceof Date ? value : new Date(value);\n  if (Number.isNaN(date.getTime())) return { time: \"\", day: String(value) };\n\n  const now = new Date();\n  const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());\n  const target = new Date(date.getFullYear(), date.getMonth(), date.getDate());\n  const diffDays = Math.round((target.getTime() - today.getTime()) / 86_400_000);\n\n  const time = `${String(date.getHours()).padStart(2, \"0\")}:${String(date.getMinutes()).padStart(2, \"0\")}`;\n\n  if (diffDays === 0) return { time, day: \"Today\" };\n  if (diffDays === 1) return { time, day: \"Tomorrow\" };\n  if (diffDays > 1 && diffDays < 7) return { time, day: WEEKDAYS[date.getDay()]! };\n  return { time, day: `${MONTHS[date.getMonth()]} ${date.getDate()}` };\n}\n\nexport interface MatchCardProps {\n  match: Match;\n  className?: string;\n  onMatchClick?: (match: Match) => void;\n  variant?: \"default\" | \"bordered\";\n}\n\nfunction TeamRow({\n  entry,\n  isLive,\n  isLeading,\n  variant = \"default\",\n}: {\n  entry: MatchTeam;\n  isLive?: boolean;\n  isLeading?: boolean;\n  variant?: \"default\" | \"bordered\";\n}) {\n  const isWinner = entry.isWinner === true;\n  const isLoser = entry.isWinner === false;\n  const showBorders = variant === \"bordered\";\n\n  return (\n    <div\n      className={cn(\n        \"flex items-center gap-2 px-2.5 py-1.5\",\n        showBorders && \"border-l-3\",\n        showBorders && isWinner && \"border-l-emerald-500\",\n        showBorders && isLoser && \"border-l-destructive\",\n        showBorders && !isWinner && !isLoser && \"border-l-transparent\",\n      )}\n    >\n      <div className=\"flex items-center gap-2 min-w-0 flex-1\">\n        {entry.team?.logo && (\n          <img\n            src={entry.team.logo}\n            alt={entry.team.name}\n            className=\"h-4 w-4 shrink-0 object-contain\"\n          />\n        )}\n        <span\n          className={cn(\n            \"truncate text-sm leading-none\",\n            isWinner && \"font-semibold text-card-foreground\",\n            isLoser && \"text-card-foreground/40\",\n            !isWinner && !isLoser && \"text-card-foreground\",\n            !entry.team && \"text-muted-foreground\",\n          )}\n        >\n          {entry.team?.name ?? \"TBD\"}\n        </span>\n      </div>\n      <span\n        className={cn(\n          \"text-sm tabular-nums shrink-0 leading-none font-medium\",\n          isLive && isLeading && \"text-emerald-500\",\n          isLive && isLeading === false && \"text-destructive\",\n          !isLive && isWinner && \"text-card-foreground\",\n          !isLive && isLoser && \"text-card-foreground/40\",\n        )}\n      >\n        {entry.score}\n      </span>\n    </div>\n  );\n}\n\nexport function MatchCard({ match, className, onMatchClick, variant = \"default\" }: MatchCardProps) {\n  const bestOfLabel = match.bestOf ? `BO${match.bestOf}` : undefined;\n  const isLive = match.status === \"live\";\n  const isCompleted = match.status === \"completed\";\n  const hasHeader = !isCompleted && (isLive || match.scheduledAt || bestOfLabel);\n\n  return (\n    <div\n      className={cn(\n        \"relative w-(--bracket-match-width,11rem) shadow-sm\",\n        hasHeader ? \"rounded-b-sm\" : \"rounded-sm\",\n        \"border-border\",\n        \"bg-card\",\n        \"text-card-foreground\",\n        \"shadow-sm overflow-visible\",\n        isLive && \"border-destructive border\",\n        onMatchClick && \"cursor-pointer hover:border-primary/50 transition-colors\",\n        className,\n      )}\n      onClick={onMatchClick ? () => onMatchClick(match) : undefined}\n    >\n      {hasHeader && (\n        <div\n          className={cn(\n            \"absolute bottom-full flex items-center justify-between px-2.5 py-1 text-xs rounded-t-sm\",\n            isLive ? \"-inset-x-px\" : \"inset-x-0\",\n            isLive ? \"text-primary bg-destructive\" : \"text-muted-foreground bg-muted\",\n          )}\n        >\n          <span className=\"flex items-center gap-1.5\">\n            {isLive && (\n              <>\n                <span className=\"relative flex h-2 w-2\">\n                  <span className=\"absolute inline-flex h-full w-full animate-ping rounded-full bg-primary opacity-75\" />\n                  <span className=\"relative inline-flex h-2 w-2 rounded-full bg-primary\" />\n                </span>\n                <span className=\"font-semibold uppercase\">Live</span>\n              </>\n            )}\n            {!isLive &&\n              match.scheduledAt &&\n              (() => {\n                const schedule = formatSchedule(match.scheduledAt!);\n                return (\n                  <span className=\"flex items-center gap-1\">\n                    <span className=\"font-bold text-[10px] mt-[1px]\">{schedule.time}</span>\n                    <span>{schedule.day}</span>\n                  </span>\n                );\n              })()}\n            {!isLive && !match.scheduledAt && <span>Unscheduled</span>}\n          </span>\n          {bestOfLabel && (\n            <span className={cn(\"ml-auto\", isLive && \"font-semibold\")}>{bestOfLabel}</span>\n          )}\n        </div>\n      )}\n      <TeamRow\n        entry={match.teams[0]}\n        isLive={isLive}\n        variant={isCompleted ? variant : \"default\"}\n        isLeading={\n          isLive\n            ? match.teams[0].score > match.teams[1].score\n              ? true\n              : match.teams[0].score < match.teams[1].score\n                ? false\n                : undefined\n            : undefined\n        }\n      />\n      <div className=\"border-t border-border\" />\n      <TeamRow\n        entry={match.teams[1]}\n        isLive={isLive}\n        variant={isCompleted ? variant : \"default\"}\n        isLeading={\n          isLive\n            ? match.teams[1].score > match.teams[0].score\n              ? true\n              : match.teams[1].score < match.teams[0].score\n                ? false\n                : undefined\n            : undefined\n        }\n      />\n    </div>\n  );\n}\n",
      "type": "registry:component",
      "target": "components/bracketcore/match-card.tsx"
    },
    {
      "path": "registry/bracketcore/bracket-types.ts",
      "content": "export interface Team {\n  id: string;\n  name: string;\n  logo?: string;\n  seed?: number;\n}\n\nexport interface MatchTeam {\n  team: Team | null;\n  score: number;\n  isWinner?: boolean;\n}\n\nexport interface Match {\n  id: string;\n  round: number;\n  position: number;\n  bestOf?: number;\n  scheduledAt?: Date | string;\n  status?: MatchStatus;\n  teams: [MatchTeam, MatchTeam];\n}\n\nexport type MatchStatus = \"upcoming\" | \"live\" | \"completed\";\n\nexport interface Round {\n  name: string;\n  matches: Match[];\n}\n\nexport interface SingleEliminationBracket {\n  type: \"single-elimination\";\n  rounds: Round[];\n}\n\nexport interface DoubleEliminationBracket {\n  type: \"double-elimination\";\n  upper: Round[];\n  lower: Round[];\n  grandFinal?: Match;\n}\n\nexport interface SwissStanding {\n  team: Team;\n  wins: number;\n  losses: number;\n  tiebreaker?: number;\n  status?: \"advancing\" | \"eliminated\" | \"pending\";\n}\n\nexport interface SwissRound {\n  name: string;\n  record?: string;\n  matches: Match[];\n}\n\nexport interface SwissBracket {\n  type: \"swiss\";\n  rounds: SwissRound[];\n  standings: SwissStanding[];\n  winsToAdvance: number;\n  lossesToEliminate: number;\n}\n\nexport interface GroupStanding {\n  team: Team;\n  wins: number;\n  losses: number;\n  draws: number;\n  points: number;\n  differential: number;\n}\n\nexport interface Group {\n  name: string;\n  teams: Team[];\n  matches: Match[];\n  standings: GroupStanding[];\n}\n\nexport interface GroupStageBracket {\n  type: \"group-stage\";\n  groups: Group[];\n}\n\nexport type Bracket =\n  | SingleEliminationBracket\n  | DoubleEliminationBracket\n  | SwissBracket\n  | GroupStageBracket;\n",
      "type": "registry:lib",
      "target": "types/bracketcore.ts"
    }
  ],
  "type": "registry:component"
}